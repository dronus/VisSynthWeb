<!DOCTYPE  html>
<html>
<head>
	<title>WebCamVidja Demo</title>
	<script type="text/javascript" src="../src/glfx.js"></script>
	<script src="../src/video.js"></script>
</head>
<body>
	<style>
		html,body,canvas{
			width: 100%;
			height: 100%;
			padding: 0px;
			margin: 0px;
			overflow: hidden;
			background-color: #000;
		}
	</style>

	<script>
		function get_cookie(cookie_name)
		{
			var cookie = document.cookie;
			var cookies = cookie.split(';');
			for (var i=0; i<cookies.length; ++i)
			{
				parts = cookies[i].split('=');
				if (parts[0].trim()==cookie_name)
				{
					return parts[1].trim();
				}
			}

		}

		function set_cookie(key,value)
		{
			document.cookie = key+'='+value+';path=/;expires=Thu, 1 Jan 2095 00:00:00 GMT;';
		}
	</script>
	<script>
		
		var b,c;
		
		var w=640, h=480;
		
		c = wcvj.webcam('c', {canvas: true, glfx: true});
		// c.setFilter[['ink',[0.4]]]);
		var t=0;

		var pc=get_cookie('perspective');
		var perspective=pc ? JSON.parse(pc) :   [0,0,0,h,w,0,w,h];

		c.canvas.addEventListener('click',function(e){
			var x=e.offsetX/c.canvas.offsetWidth*w, y=e.offsetY/c.canvas.offsetHeight*h;
			var i=0;
			if(x>w/2) i+=2;
			if(y>h/2) i+=1;
			perspective[i*2]=x;
			perspective[i*2+1]=y;	
			set_cookie('perspective',JSON.stringify(perspective));		
		});

		s=.5;

		var effects=[
			function(t){ return ['hexagonalPixelate',[0,0,6]];},
			function(t){ return ['colorHalftone',[0,0,30,3]];},
			function(t){ return ['unsharpMask',[3,.5]];},
			function(t){ return ['swirl',[300, 246.5, 250, Math.sin(t)*1.0]];},
		];

		var special=effects[3];		

		var animation=function(){
			t+=.001;
			if(t>2*Math.PI) t=0;
			c.setFilter([['vibrance',[.5]],special(t),['matrixWarp',[[s,0,0,s],false,true]],['perspective',[[0,0,0,h,w,0,w,h],perspective]]]);
			requestAnimationFrame(animation);
		};
		animation();
		document.body.appendChild(c.canvas);		

		setInterval(function(){
			special=effects[Math.floor(Math.random()*effects.length)];
		},30000);
	

	</script>
</body>
</html>
